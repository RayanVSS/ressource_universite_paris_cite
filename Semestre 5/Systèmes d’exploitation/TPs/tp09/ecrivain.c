#include <sys/types.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <fcntl.h>
#include <limits.h>

int main(int argc, char const *argv[]) {
    size_t sz = strlen("Yoloo ! \n"); 
    char buf[sizeof(pid_t) + sz + sizeof(size_t)];
    int ecr , pos = 0 ; 
    int fd = open(argv[1], O_WRONLY);
    pid_t pid = getpid() ; 

    if (fd < 0) exit(EXIT_FAILURE);
    else printf("ouverture du tube effectuée\n"); 

    memmove(buf+pos , &pid , sizeof(pid_t)) ; 
    pos += sizeof(pid_t) ; 
    memmove(buf+pos , &sz , sizeof(size_t)) ; 
    pos += sizeof(size_t) ; 
    memmove(buf+pos , "Yoloo !\n" , sz) ; 
    pos += sz; 
    ecr = write(fd, buf, sizeof(pid_t)+sz+sizeof(size_t));

    if (ecr <= 0)
        perror("pb write");
    else
        printf("%d écriture de %d caractères terminée : %s...\n",pid , ecr, buf );

    close(fd);
    return 0;
}
