#include <sys/types.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <fcntl.h>
#include <limits.h>
#include <stdint.h>

int main(int argc, char *argv[]) {

  if (argc < 4) {
    printf("usage: ./ecrivain <tube> <nombre de caracteres> <caractere>\n");
    exit(EXIT_FAILURE);
  }

  char * buf = NULL;
  char c = argv[3][0];
  int i, ecr, len = atoi(argv[2]);
  int fd = open(argv[1], O_WRONLY);

  if (fd < 0) exit(EXIT_FAILURE);
  else printf("ouverture du tube effectuée\n"); 

  buf = malloc(len);
  if (buf == NULL) { perror("malloc"); exit(1); }
  
  for (i=0; i<len; i++) buf[i] = c;

  ecr = write(fd, buf, len);

  if (ecr <= 0)
    perror("pb write");
  else
    printf("écriture de %d caractères terminée : %c...\n", ecr, *(buf));

  close(fd);
  free(buf);
  return 0;
}
