#include "sys/types.h"
#include "sys/unistd.h"
#include "sys/wait.h"
#include "fcntl.h"
#include "stdlib.h"
#include "stdio.h"

void f (void) {
    srandom(getpid()) ; 
    exit(random()%256);
}

int main(int argc, char const *argv[]){
    srandom(getpid()) ; 
    int secret = random()%256 ;
    pid_t tabfils[10] ; 
    int valfils[10] ;
    for (int i = 0 ; i<10; i++) {
        int r = fork() ; 
        switch (r){
        case -1 :
            return EXIT_FAILURE;
        case 0:
            f();
            break;
        default:
            tabfils[i] = r;
            int status = 0 ; 
            waitpid(r , &status , 0);
            valfils[i] = WEXITSTATUS(status);
            break;
        }
    }
    int winner = 0;
    for (int i = 1; i < 10 ; i++) {
        if (abs(valfils[winner] - secret) > abs(valfils[i] - secret)) {
            winner = i ; 
        }
    }
    printf("aandd the winner is number %d with pid => %d with number %d close to %d\n" 
    , winner , tabfils[winner] , valfils[winner] , secret);
    return 0;
}
