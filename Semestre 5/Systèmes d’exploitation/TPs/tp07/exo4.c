#include "sys/types.h"
#include "sys/unistd.h"
#include "sys/wait.h"
#include "fcntl.h"
#include "stdlib.h"
#include "stdio.h"

int indexOf (pid_t *pid , pid_t fils) {
    for (int i = 0 ; i<4 ; i++) {
        if (*(pid+i) == fils) return i ; 
    }
    return -1 ; 
}

int main(int argc, char const *argv[]){
    pid_t pidfils[4] = {0 , 0 , 0 , 0};
    int t[4] = {0 , 0 , 0 , 0};
    int nbfinished = 0 ; 
    for (int i = 0 ; i<4 ; i++) {
        pidfils[i] = fork() ; 
        switch (pidfils[i]) {
        case 0:
            sleep(20) ;
            puts("ouii , c'est bon jss laa");
            exit(0) ; 
            break;
        default :
            break;    
        }
    }
            int status = 0 ; 
            pid_t pid = 0 ; 
            for (int i = 0 ; i<4 ; i++) {
                printf("%d," , pidfils[i]) ;
            }
            puts("bougez vous venezz !!!");
            int i = 0 ; 
            do {   
                puts("venezzzz !!!") ; 
                pid = waitpid(pidfils[i++ % 4] , &status , WNOHANG); 
                switch (pid){
                case -1:
                    perror("problem with waitpid()"); 
                    exit(EXIT_FAILURE);
                    break;
                case 0 :
                    break;
                default:
                    nbfinished++ ; 
                    printf("ahh boila %d est venu !\n" , pid) ; 
                    t[indexOf(pidfils , pid)] = -1 ; 
                    break;
                }
                sleep(2) ; 
            } while (nbfinished != 3);
            printf("bon ,") ; 
            for (int i = 0 ; i<4 ; i++) {
                if (t[i] == -1) printf("%d," , pidfils[i]) ; 
            }
            printf("sont venusss , il reste plus que qu'unn !") ; 

            do{
              puts("viensss !!!") ; 
              sleep(2) ;   
            } while (!waitpid(-1 , &i , WNOHANG));
            puts("allez enfinn on est laa !!") ;
        
    return 0;
}
