#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <signal.h>
#include <sys/wait.h>
#include <sys/types.h>
#include <errno.h> 
#include <dirent.h>
#include <sys/stat.h>

void handler (int sig) {
}

int main(int argc, char const *argv[]){
    struct sigaction action = {0};
    action.sa_handler = handler ;
    sigaction(SIGUSR1, &action, NULL);

    // Block SIGUSR1
    sigset_t mask , oldmask ; 
    sigemptyset(&mask);

    for (int i = 0 ; i<10 ; i++) {
        pid_t pid = fork();
        switch (pid) {
            case 0:
                sigsuspend(&mask);
                srandom(getpid());
                sleep(random()%5);
                printf("[%d] me voilaa\n" , getpid());
                exit(0) ;
                break;
            case -1:
                perror("fork");
                exit(EXIT_FAILURE);
            default:
                break;    
        }
    }
    srandom(getpid());
    sleep(random()%10);
    kill(0 , SIGUSR1);
    errno = 0 ;
    do {
        pid_t pid = wait(NULL);
        if (pid != -1) printf("ahhh te voila %d\n" , pid);
    }while(errno != ECHILD);
    return 0;
}
